
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../sama-bringup/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Zynq bring-up - mPMT board documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zynq-bring-up" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="mPMT board documentation" class="md-header__button md-logo" aria-label="mPMT board documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            mPMT board documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Zynq bring-up
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/gtortone/mpmt-board" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    gtortone/mpmt-board
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="mPMT board documentation" class="md-nav__button md-logo" aria-label="mPMT board documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    mPMT board documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gtortone/mpmt-board" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    gtortone/mpmt-board
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware specification
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment-server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment server
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sama-bringup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SAMA bring-up
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Zynq bring-up
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Zynq bring-up
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    <span class="md-ellipsis">
      Requirements
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#principle-of-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Principle of operations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setup-environment-variables" class="md-nav__link">
    <span class="md-ellipsis">
      Setup environment variables
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Setup environment variables">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uenvtxt-example" class="md-nav__link">
    <span class="md-ellipsis">
      uEnv.txt example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#start-zynq-bring-up" class="md-nav__link">
    <span class="md-ellipsis">
      Start Zynq bring-up
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Start Zynq bring-up">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-fetching-priority" class="md-nav__link">
    <span class="md-ellipsis">
      File fetching priority
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#advanced-options" class="md-nav__link">
    <span class="md-ellipsis">
      Advanced options
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Advanced options">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qspi-memory" class="md-nav__link">
    <span class="md-ellipsis">
      QSPI memory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="QSPI memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partitioning-schema" class="md-nav__link">
    <span class="md-ellipsis">
      Partitioning schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#zynq-boot-using-qspi-minimal-root-filesystem" class="md-nav__link">
    <span class="md-ellipsis">
      Zynq boot using QSPI minimal root filesystem
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-qspi-flashing-from-u-boot" class="md-nav__link">
    <span class="md-ellipsis">
      Manual QSPI flashing (from U-Boot)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#manual-qspi-flashing-from-linux" class="md-nav__link">
    <span class="md-ellipsis">
      Manual QSPI flashing (from Linux)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#emmc-memory" class="md-nav__link">
    <span class="md-ellipsis">
      eMMC memory
    </span>
  </a>
  
    <nav class="md-nav" aria-label="eMMC memory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#manual-emmc-flashing" class="md-nav__link">
    <span class="md-ellipsis">
      Manual eMMC flashing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="zynq-bring-up">Zynq bring-up</h1>
<h2 id="requirements">Requirements</h2>
<ul>
<li><a href="../sama-bringup/">SAMA</a> up and running</li>
<li><a href="../deployment-server/">Deployment server</a> configured and running</li>
</ul>
<h2 id="principle-of-operations">Principle of operations</h2>
<p>Installation of Zynq starts from SAMA using <a href="https://openocd.org">openocd</a> JTAG tool to 'inject' U-Boot bootloader binary in Zynq RAM.
A set of U-Boot environment variables are also injected with openocd in Zynq RAM and used as parameters for Zynq installation and configuration.
Environment variables are passed to Linux operating system using kernel command-line parameters (U-Boot environment variable <code>bootargs</code>).</p>
<h2 id="setup-environment-variables">Setup environment variables</h2>
<p>Zynq bring-up scripts are available on SAMA in <code>/opt/jtag-scripts</code> directory. Before starting Zynq bring-up user must set configuration
and installation parameters using file <code>/opt/jtag-scripts/uEnv.txt</code>.</p>
<p>The following table summarize meaning of <code>uEnv.txt</code> variables:</p>
<table>
<thead>
<tr>
<th>variable</th>
<th>description</th>
<th>notes</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bootmode</code></td>
<td>if equal to <code>bootmode</code> U-Boot starts unattended Zynq installation</td>
<td></td>
</tr>
<tr>
<td><code>mpmtsn</code></td>
<td>mPMT board serial number</td>
<td>mPMT board serial number will be written on QSPI partition mtd:userdata during installation</td>
</tr>
<tr>
<td><code>mpmttype</code></td>
<td>mPMT board type (<code>plain</code> or <code>led</code>)</td>
<td>mPMT board type will be written on QSPI partition mtd:userdata during installation</td>
</tr>
<tr>
<td><code>tasklist</code></td>
<td>a list of scripts automatically executed from Zynq at Linux boot</td>
<td>tasks home directory is <code>/opt/setup-scripts</code></td>
</tr>
<tr>
<td><code>tftphost</code></td>
<td>TFTP server hostname</td>
<td>if defined overrides <code>serverip</code> received by DHCP option 66</td>
</tr>
<tr>
<td><code>tftphome</code></td>
<td>TFTP server mPMT board home directory</td>
<td>if defined overrides default value <code>/mpmt/zynq</code></td>
</tr>
<tr>
<td><code>httphost</code></td>
<td>HTTP server hostname</td>
<td></td>
</tr>
<tr>
<td><code>httpport</code></td>
<td>HTTP server port number</td>
<td></td>
</tr>
<tr>
<td><code>httphome</code></td>
<td>HTTP server mPMT board home directory</td>
<td></td>
</tr>
</tbody>
</table>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Default configuration is provided for <code>tasklist</code> so usually there is no need to change this variable. User must be sure that
HTTP and TFTP variables reflect his own deployment server configuration.</p>
</div>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>User can also set in uEnv.txt file environment variables related to fixed IP configuration or other U-Boot options. A detailed list of
U-Boot environment variables is available <a href="https://docs.u-boot.org/en/latest/usage/environment.html">here</a></p>
</div>
<h3 id="uenvtxt-example">uEnv.txt example</h3>
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>#
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a># bootmode
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>#
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>bootmode=recovery
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>#
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a># mPMT serial number
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>#
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>mpmtsn=AABBCCDDEE112233445566
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>#
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a># mPMT type
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>#
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>mpmttype=plain
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>#
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a># settings for automatic execution at Linux boot
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>#
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>tasklist=deploy_qspi_userdata,deploy_qspi_bootbin -p http,deploy_qspi_fitimage -p http,deploy_emmc_rootfs -p http -r rfs-images/zynq-mpmt-debian.tar.lz4
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>#
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a># settings for TFTP server
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a>#
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a>tftphome=/mpmt/zynq/
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>#
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a># settings for HTTP server
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a>#
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a>httphost=10.1.3.3
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a>httpport=8080
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>httphome=/mpmt/zynq
</span></code></pre></div>
<h2 id="start-zynq-bring-up">Start Zynq bring-up</h2>
<p>User can monitor whole Zynq bring-up process connecting by SSH to SAMA and opening serial console with <code>minicom</code>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>minicom -D /dev/ttyS1
</span></code></pre></div>
<p>Using an additional SSH session on SAMA user can start main setup script after <a href="./#setup-environment-variables">uEnv.txt</a> setup:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>cd /opt/jtag-script
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>./boot-zynq
</span></code></pre></div>
<p>The script <code>boot-zynq</code> uses openocd to inject U-Boot image and uEnv.txt to Zynq DDR. The whole bring-up process takes around 6 minutes
during which status messages are displayed on serial console. QSPI flash and eMMC are partitioned and initialized with files fetched
from deployment server using environment passed with uEnv.txt. The Linux login prompt indicates end of bring-up process.</p>
<h3 id="file-fetching-priority">File fetching priority</h3>
<p>A file fetching priority mechanism is implemented to customize mPMT board Zynq setup. If a script try to download a file called
<code>filename.bin</code> using HTTP protocol and defined <code>httphome</code> directory is <code>/mpmt/zynq</code> the following attempts are made
using defined environment variables:</p>
<ol>
<li><code>http://&lt;httphost&gt;:&lt;httpport&gt;/&lt;httphome&gt;/&lt;mac_address&gt;/filename.bin</code></li>
<li><code>http://&lt;httphost&gt;:&lt;httpport&gt;/&lt;httphome&gt;/default/&lt;mpmttype&gt;/filename.bin</code></li>
<li><code>http://&lt;httphost&gt;:&lt;httpport&gt;/&lt;httphome&gt;/default/filename.bin</code></li>
</ol>
<p>Next attempts in list will be skipped at first success.</p>
<h2 id="advanced-options">Advanced options</h2>
<h3 id="qspi-memory">QSPI memory</h3>
<h4 id="partitioning-schema">Partitioning schema</h4>
<p>Zynq SoC is equipped with a 32MByte flash QSPI. During Zynq setup QSPI memory is partitioned following this schema:</p>
<table>
<thead>
<tr>
<th>start addr</th>
<th>size</th>
<th>name</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x0000000</td>
<td>7MB</td>
<td>mtd:bootbin</td>
<td>BOOT.BIN</td>
</tr>
<tr>
<td>0x06C0000</td>
<td>26MB</td>
<td>mtd:fitimage</td>
<td>Linux FIT image: kernel, device tree, minimal root filesystem</td>
</tr>
<tr>
<td>0x1FF0000</td>
<td>64KB</td>
<td>mtd:userdata</td>
<td>mPMT board serial number and mPMT type</td>
</tr>
</tbody>
</table>
<h4 id="zynq-boot-using-qspi-minimal-root-filesystem">Zynq boot using QSPI minimal root filesystem</h4>
<p>Linux FIT image available on <code>mtd:fitimage</code> QSPI partition contains Linux kernel, device tree and minimal root filesystem
and it can be used from U-Boot to boot Zynq with a minimal root filesystem. To start QSPI boot user can open Zynq serial
console from SAMA using minicom, reboot Linux and interrupt U-Boot countdown. After these steps QSPI boot can be launched
at U-Boot prompt:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>run bootqspi
</span></code></pre></div>
<h4 id="manual-qspi-flashing-from-u-boot">Manual QSPI flashing (from U-Boot)</h4>
<p>It is possible to flash <code>mtd:bootbin</code> and <code>mtd:fitimage</code> QSPI partitions using U-Boot scripts:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>run flash_bootbin
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>run flash_fitimage
</span></code></pre></div>
<p>The download protocol is fixed as TFTP and environment variable used must be defined using uEnv.txt with openocd or
manually. Files will be fetched from deployment server using <a href="./#file-fetching-priority">file fetching priority</a>.</p>
<h4 id="manual-qspi-flashing-from-linux">Manual QSPI flashing (from Linux)</h4>
<p>It is possible to manually run setup scripts starting from QSPI boot. Setup scripts are located in <code>/opt/setup-scripts</code>.
Setup scripts to initialize QSPI flash partitions (<code>deploy_qspi_bootbin</code>, <code>deploy_qspi_fitimage</code>, <code>deploy_qspi_userdata</code>) 
accept following options:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>-p &lt;protocol&gt;   download protocol {tftp|http}    (mandatory)
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>-c &lt;filename&gt;   configuration file               (optional)
</span></code></pre></div>
<p>The download protocol can be selected reflecting deployment server configuration, while configuration file contains
environment variables as specified for <a href="./#setup-environment-variables">uEnv.txt</a>. Files will be fetched
from deployment server using <a href="./#file-fetching-priority">file fetching priority</a>.</p>
<h3 id="emmc-memory">eMMC memory</h3>
<h4 id="manual-emmc-flashing">Manual eMMC flashing</h4>
<p>Zynq eMMC is partitioned (one Linux partition) and formatted using <code>deploy_emmc_rootfs</code> setup script that accepts following options:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>-p &lt;protocol&gt;   download protocol {tftp|http}              (mandatory)
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>-r &lt;filename&gt;   rootfs file (.tar.gz | .tar.lz4 | .tar)    (mandatory)
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>-c &lt;filename&gt;   configuration file                         (optional)
</span></code></pre></div>
<p>The download protocol can be selected reflecting deployment server configuration, while configuration file contains
environment variables as specified for <a href="./#setup-environment-variables">uEnv.txt</a>. Root filesystem image will be fetched
from deployment server using <a href="./#file-fetching-priority">file fetching priority</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Due to Linux root filesystem image huge size (&gt;1GB) usage of TFTP protocol is highly discouraged because it does not support
'streaming mode' and takes a lot of time to setup whole eMMC. HTTP is preferred and most reliable solution for eMMC flashing.</p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["toc.integrate", "navigation.path", "navigation.top", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>