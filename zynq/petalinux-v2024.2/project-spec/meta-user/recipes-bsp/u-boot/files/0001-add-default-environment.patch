From 3fcb7a7aa6c040265bee5701dc309bd82f7ba58d Mon Sep 17 00:00:00 2001
From: Gennaro Tortone <gennaro.tortone@na.infn.it>
Date: Fri, 21 Feb 2025 15:52:45 +0000
Subject: [PATCH] add default environment

Signed-off-by: Gennaro Tortone <gennaro.tortone@na.infn.it>
---
 default-uEnv.txt | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)
 create mode 100644 default-uEnv.txt

diff --git a/default-uEnv.txt b/default-uEnv.txt
new file mode 100644
index 0000000000..eb024f7900
--- /dev/null
+++ b/default-uEnv.txt
@@ -0,0 +1,26 @@
+ethprime=ethernet@e000b000
+devicetree_load_address=0x2000000
+kernel_load_address=0x2080000
+initrd_load_address=0x5000000
+load_address=0x09000000
+autoload=no
+bootdelay=5
+bootmedia=mmc
+tftphome=/mpmt/zynq
+bootcmd=run boot${bootmedia}
+nc=setenv stdout nc;setenv stdin nc
+readmac=i2c dev 0; i2c read 50 FA.1 6 0xFFFFFC00
+mtdparts=mtdparts=nor0:0x6B0000@0(bootbin),0x1920000@0x6C0000(fitimage),0x10000@0x1FF0000(user)
+get_ip=dhcp ; while itest $? != 0; do dhcp; done ; if test -n "$serverip" -a -z "$tftphost"; then setenv tftphost ${serverip}; fi
+preboot=sf probe 0 0 ; run readmac buildmac ; if test -z "$ipaddr"; then run get_ip; fi ; env import ${load_address} ; if test -n "$mpmtsn"; then setenv bootargs ${bootargs} mpmtsn=${mpmtsn}; fi ; if test -n "$mpmttype"; then setenv bootargs ${bootargs} mpmttype=${mpmttype}; fi ; if test -n "$tftphost"; then setenv bootargs ${bootargs} tftphost=${tftphost}; fi; if test -n "$tftphome"; then setenv bootargs ${bootargs} tftphome=${tftphome}; fi; if test -n "$httphost"; then setenv bootargs ${bootargs} httphost=${httphost}; fi; if test -n "$httphome"; then setenv bootargs ${bootargs} httphome=${httphome}; fi; if test -n "$httpport"; then setenv bootargs ${bootargs} httpport=${httpport}; fi; if test -n "$tasklist"; then setenv bootargs ${bootargs} tasklist=${tasklist}; fi ; run download_uenv && env import ${load_address} ; if test "$bootmode" = "recovery" ; then run bootnet ; fi ; if test -n "$autoexec"; then run autoexec; fi
+buildmac=setenv e "" ; setenv sep ""; for i in 0 1 2 3 4 5 ; do setexpr x 0xFFFFFC00 + $i ; setexpr.b b *$x ; if itest.b ${b} <= 0xF; then setenv b 0${b}; fi ; setenv e "$e$sep$b" ; setenv sep : ; done && env set ethaddr $e && setexpr ethaddr_str gsub : - ${ethaddr} && echo == MAC address set to $ethaddr from eeprom ; 
+bootargs=earlyprintk earlycon clk_ignore_unused cpuidle.off=1 uio_pdrv_genirq.of_id=generic-uio net.ifnames=0
+bootqspi=sf probe 0 0 && mtd read fitimage ${load_address} ; bootm ${load_address}
+bootnet=if test -z "$ipaddr"; then run get_ip; fi ; run download_fitimage && bootm ${load_address}
+bootmmc=setenv bootargs ${bootargs} root=/dev/mmcblk0p1 rw rootwait cma=320M && load mmc 0 ${load_address} /boot/image.ub && imxtract ${load_address} kernel-1 ${kernel_load_address} && imxtract ${load_address} fdt-system-top.dtb ${devicetree_load_address} && bootz ${kernel_load_address} - ${devicetree_load_address}
+download_uenv=tftpboot ${load_address} $tftphost:${tftphome}/${ethaddr_str}/uenv.txt || tftpboot ${load_address} $tftphost:${tftphome}/default/${mpmttype}/uenv.txt || tftpboot ${load_address} $tftphost:${tftphome}/default/uenv.txt
+download_bootbin=tftpboot ${load_address} $tftphost:${tftphome}/${ethaddr_str}/BOOT.BIN || tftpboot ${load_address} $tftphost:${tftphome}/default/${mpmttype}/BOOT.BIN || tftpboot ${load_address} $tftphost:${tftphome}/default/BOOT.BIN
+download_fitimage=tftpboot ${load_address} $tftphost:${tftphome}/${ethaddr_str}/image.ub || tftpboot ${load_address} $tftphost:${tftphome}/default/${mpmttype}/image.ub || tftpboot ${load_address} $tftphost:${tftphome}/default/image.ub
+flash_bootbin=if test -z "$ipaddr"; then run get_ip; fi ; run download_bootbin && mtd erase bootbin && mtd write bootbin ${load_address}
+flash_fitimage=if test -z "$ipaddr"; then run get_ip; fi ; run download_fitimage && mtd erase fitimage && mtd write fitimage ${load_address}
+verify_bootbin=if test -z "$ipaddr"; then run get_ip; fi ; run download_bootbin && mtd read bootbin 0xA000000 0 ${filesize} && cmp.b ${load_address} 0xA000000 ${filesize}
